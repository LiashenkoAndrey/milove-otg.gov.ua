<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="~{fragments/basic-head.html :: basic-head}"></head>
<link rel="stylesheet" th:href="@{/styles/notifications.css}">
<link rel="stylesheet" th:href="@{/styles/document.css}">
<link rel="stylesheet" th:href="@{/styles/administration.css}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

<title th:replace="~{/fragments/common.html :: generic-title}"></title>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.8.2/tinymce.min.js" integrity="sha512-laacsEF5jvAJew9boBITeLkwD47dpMnERAtn4WCzWu/Pur9IkF0ZpVTcWRT/FUCaaf7ZwyzMY5c9vCcbAAuAbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!--notifications -->
<div th:replace="~{fragments/notification.html :: notifications}"></div>

<!-- forms -->
<div th:replace="~{fragments/forms.html :: formWithOneInput}"></div>
<div th:replace="~{fragments/forms.html :: confirm-form}"></div>
<div th:replace="~{fragments/forms.html :: employee-form}"></div>
<div th:replace="~{fragments/forms.html :: document}"></div>

<style>
   #sub_institution, #sub_institution_title  {display: none;}
</style>

<div class="wrapper">
    <div th:replace="~{fragments/header.html :: header}"></div>

    <div class="content container"  style="min-height: 700px">
        <div>
            <div>
                <h2 class="text-center p-3">Керівництво</h2>
                <button sec:authorize="hasAuthority('ADMIN')" class="btn btn-success mb-3 ms-3 admin-btn" th:onclick="'enableFormAndInjectAction(\'/administration/group/null/employee/new\', \'Додати\')'">Додати працівника</button>
                <div>
                    <div class="row ms-4 me-4 mb-2 p-2" style="background-color: white; border-radius: 3px;" th:each="main_employee : ${main_employees}">
                        <div class="col-sm-2 text-center">
                            <img th:src="'/upload/image/' + ${main_employee.image_id}"  height="130" width="130"  style="display: inline-block; border-radius: 3px" alt="...">
                        </div>

                        <div class="col mt-4" >
                            <h3 th:text="${main_employee.position}" style="font-size: 28px; font-weight: bold"></h3>
                            <p class="h4" style="font-size: 28px" th:text="${main_employee.first_name} + ' ' + ${main_employee.last_name}">Марія В. В</p>
                        </div>
                        <div class="p-1 mx-1"  style="width: 110px" sec:authorize="hasAuthority('ADMIN')">
                            <button class="btn btn-info m-1 admin-btn" style="width: 100px" th:onclick="'enableFormAndInjectAction(\'/administration/employee/' + ${main_employee.id} + '/update\', \'Оновити\')'">Оновити</button>
                            <button class="btn btn-danger m-1 admin-btn" style="width: 100px"  th:onclick="'enableFormAndDoGetRequest(\'Ви впевненні що хочете видалити працівника\',\'Так, видалити\',\'/administration/employee/' + ${main_employee.id} + '/delete\',\'null\')'">Видалити</button>
                        </div>
                    </div>
                </div>

                <button sec:authorize="hasAuthority('ADMIN')" class="btn btn-success mb-2 ms-3 admin-btn" onclick="enableFormAndDoPostRequest('Додати', '/administration/group/new', 'Назва групи')">Додати групу</button>

                <div class="accordion accordion-flush"  id="accordionFlushExample">
                    <div class="accordion-item"  th:each="group : ${groups}">
                        <h2 class="accordion-header" th:id="'flush-heading' + ${group.id}">
                            <!--title-->
                            <button th:text="${group.title}" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" th:data-bs-target="'#flush-collapse' + ${group.id}" aria-expanded="false" th:aria-controls="'flush-collapse' + ${group.id}"></button>
                        </h2>
                        <div th:id="'flush-collapse'+ ${group.id}" class="accordion-collapse collapse" th:aria-labelledby="'flush-heading' + ${group.id} " data-bs-parent="#accordionFlushExample">

                            <div class="accordion-body">
                                <div class="accordion accordion-flush col mt-3 me-4" id="accordionFlush2"  >
                                    <div th:replace="~{fragments/administration/printTable.html :: printTable(${group.employee_list})}"></div>
                                    <div th:replace="~{fragments/administration/printDocuments.html :: printDocuments(${group})}"></div>

                                    <div class="accordion-item" th:each="sub_group : ${group.group_list}">
                                        <h2 class="accordion-header" id="flush-headingOne">
                                            <!--title-->
                                            <button  th:text="${sub_group.title}" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" th:data-bs-target="'#flush-collapse' + ${sub_group.id}" aria-expanded="false" th:aria-controls="'flush-collapse' + ${sub_group.id}"></button>
                                        </h2>
                                        <div th:id="'flush-collapse' + ${sub_group.id}" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlush2">
                                            <div class="accordion-body">
                                                <div th:replace="~{fragments/administration/printTable.html :: printTable(${sub_group.employee_list})}"></div>
                                                <div th:replace="~{fragments/administration/printDocuments.html :: printDocuments(${sub_group})}"></div>
                                                <div th:replace="~{fragments/administration/groupCrudButtons.html :: groupCrudButtons(${sub_group})}"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div sec:authorize="hasAuthority('ADMIN')">
                                        <div th:replace="~{fragments/administration/groupCrudButtons.html :: groupCrudButtons(${group})}"></div>
                                        <button class="btn btn-success mt-2 admin-btn" th:onclick="'enableFormAndDoPostRequest(\'Додати\',\'/administration/group/' + ${group.id} + '/sub-group/new\', \'Назва підгрупи\')'">Додати підгрупу</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer.html :: footer}"></div>

</div>

<script th:src="@{/scripts/documentService.js}"></script>
<script th:src="@{/scripts/administrationService.js}"></script>
<script th:src="@{/scripts/employeeService.js}"></script>
<script th:src="@{/scripts/requests.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
</html>